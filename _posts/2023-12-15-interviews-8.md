---
title: '面试相关（8）'
author: litao
date: 2023-12-15 14:19:00 +0800
categories: [interviews]
tags: [interviews]





---

### 🏷️  浏览器从输入地址到页面展示都经历了哪些过程

### 1. **DNS解析**

- **DNS查询**：浏览器首先检查本地缓存中是否存在该域名的IP地址。如果没有，则会通过DNS（域名系统）服务器进行查询，将域名（如`www.example.com`）解析为对应的IP地址（如`192.168.1.1`）。
- **多级查询**：如果本地缓存、操作系统缓存都没有命中，DNS查询会递归地向上级DNS服务器发起请求，直到根DNS服务器，最终找到并返回IP地址。

### 2. **建立TCP连接**

- 三次握手

  ：获得IP地址后，浏览器与服务器建立TCP连接。这个过程称为“三次握手”，确保客户端和服务器双方准备好发送和接收数据。

  - 第一次握手：客户端向服务器发送一个SYN（同步）包。
  - 第二次握手：服务器收到SYN包后，回应一个SYN-ACK（同步确认）包。
  - 第三次握手：客户端收到SYN-ACK包后，再次发送一个ACK（确认）包，连接正式建立。

### 3. **发送HTTP请求**

- **构建请求**：浏览器构建一个HTTP请求报文，包含请求方法（如GET、POST）、请求的URL、HTTP头部信息（如Cookie、User-Agent）等。
- **发送请求**：浏览器通过建立好的TCP连接，将HTTP请求发送到服务器。

### 4. **服务器处理请求**

- **请求处理**：服务器接收到HTTP请求后，解析请求内容，确定要提供的资源（如HTML文件、图片、CSS文件等）。
- **动态内容生成**：如果请求的是动态内容（如JAVA、PHP、Python脚本），服务器会先运行对应的脚本，生成动态内容。
- **返回响应**：服务器将处理结果封装为HTTP响应报文，包含状态码（如200 OK）、响应头（如Content-Type）、响应主体（HTML内容等），然后发送回浏览器。

### 5. **浏览器接收响应**

- **接收数据**：浏览器接收到服务器返回的HTTP响应报文。
- 解析响应：浏览器解析HTTP响应中的状态码、响应头、响应主体等内容。
  - **重定向**：如果状态码是3xx（如301、302），则浏览器会根据Location头的信息，重新发起请求。
  - **缓存**：如果响应头中有缓存控制信息（如Cache-Control），浏览器可能会将响应内容缓存以备将来使用。

### 6. **关闭TCP连接，四次挥手**

**第一次挥手：客户端发送FIN**

- 客户端（通常是浏览器）发送一个FIN（Finish）包，表示它已经完成了数据发送，并且不再发送任何数据。这个包包含一个序列号，用于标识数据的结束。
- 客户端进入`FIN_WAIT_1`状态。

**第二次挥手：服务器发送ACK**

- 服务器收到FIN包后，发送一个ACK（Acknowledgment）包来确认已收到客户端的FIN请求，但服务器可能还没有准备好关闭连接，因为它可能还在处理或发送数据。
- 服务器进入`CLOSE_WAIT`状态，客户端进入`FIN_WAIT_2`状态。

**第三次挥手：服务器发送FIN**

- 当服务器处理完所有数据后，它发送一个FIN包，表示它也已经完成了数据发送，并且准备关闭连接。
- 服务器进入`LAST_ACK`状态。

**第四次挥手：客户端发送ACK**

- 客户端收到服务器的FIN包后，发送一个ACK包，表示已收到服务器的FIN请求。此时，客户端进入`TIME_WAIT`状态，以确保服务器能收到这个ACK包。
- 服务器在收到ACK包后，直接进入`CLOSED`状态，连接正式关闭。
- 客户端在`TIME_WAIT`状态保持一段时间（通常是2倍的MSL，Maximum Segment Lifetime），确保这个ACK包能够被服务器接收。如果在这段时间内没有收到重发请求，客户端也进入`CLOSED`状态，完成连接关闭。


### 🏷️  TCP\UDP 说明

#### 1. TCP

TCP 是一种面向连接的协议。在传输数据前，必须先建立连接，通过三次握手（Three-way Handshake）来建立可靠的连接。通常用在对准确性完整性要求较高的场景，如http，ftp，邮件协议（SMTP/POP3/IMAP）等场景

- 优点：传输可靠，通过校验机制，消息序号等保证了数据的准确性和完整性，数据有序到达；可根据网络拥堵状态进行流量控制
- 缺点：由于需要建立和维持连接，以及流量控制的逻辑，所以开销相对较大；为了保证数据的准确和完整性传输速度较低；

### 2. UDP

UDP 是一种无连接协议，数据可以在不建立连接的情况下直接发送到接收端，适用于对实时性要求较高的场景，如直播，游戏，视频会议等。

- 优点：由于无需建立连接，开销小；无需保证准确性，送达顺序等，速度较快；
- 缺点：数据可能丢失或乱序，不可靠；无流量控制，无法处理网络拥堵；

### 🏷️  HTTPS的加密过程

#### 1. 客户端发起请求（客户端 Hello）

- 当用户在浏览器中输入一个HTTPS网址时，客户端（通常是浏览器）会向服务器发起请求。

- 在这个请求中，客户端会发送一个 Client Hello

   消息，其中包括以下内容：

  - 客户端支持的SSL/TLS协议版本（如TLS 1.2, TLS 1.3等）。
  - 客户端支持的加密算法列表（如AES, RSA等）。
  - 客户端生成的一个随机数（用于后续密钥生成）。
  - 支持的压缩算法列表。

#### 2. 服务器响应（服务器 Hello）

- 服务器接收到 `Client Hello` 后，会根据自身的配置选择一个双方都支持的SSL/TLS协议版本和加密算法，并向客户端发送 `Server Hello` 消息。Server Hello

   包括：

  - 服务器选择的SSL/TLS协议版本。
  - 服务器选择的加密算法。
  - 服务器生成的随机数（用于后续密钥生成）。

#### 3. 服务器发送证书（SSL/TLS 证书）

- 服务器会将自己的数字证书发送给客户端。这个证书由受信任的证书颁发机构（CA）签名，通常包含以下信息：
  - 服务器的公钥。
  - 服务器的域名。
  - 证书颁发机构的签名。
  - 证书的有效期。

#### 4. 客户端验证证书

- 客户端接收到服务器的证书后，会对证书进行验证：
  - 验证证书是否由受信任的CA签发。
  - 验证证书是否在有效期内。
  - 验证证书中的域名是否与访问的域名匹配。
- 如果证书验证通过，客户端会继续进行下一步。如果验证失败，用户通常会看到一个安全警告，提示连接不安全。

#### 5. 生成并交换密钥

- **前向保密（Diffie-Hellman 交换算法或其变种）：**
  - 双方使用各自的随机数，以及之前协商的加密算法，生成一个共享的会话密钥（对称密钥），用于后续加密通信。
  - 这个过程使用Diffie-Hellman密钥交换算法（或其变种），确保密钥的安全传输，即使有人窃听数据也无法破解密钥。
- **传统RSA加密：**
  - 客户端生成一个随机数（称为“预主密钥”），并使用服务器的公钥加密这个随机数，然后发送给服务器。
  - 服务器用自己的私钥解密，得到这个预主密钥。
  - 双方使用该预主密钥和之前的随机数生成最终的会话密钥。

#### 6. 建立安全通信

- 双方生成会话密钥后，客户端和服务器都会向对方发送“Finished”消息，表明握手过程结束。此时，双方已经建立了安全通道。
- 从此刻起，所有在客户端和服务器之间传输的数据都将使用会话密钥进行加密，以确保数据的机密性和完整性。

#### 7. 传输数据

- 在安全通道建立后，客户端和服务器之间的所有HTTP请求和响应都通过加密的SSL/TLS连接传输。数据在传输过程中即使被截获，攻击者也无法解密内容。

#### 8. 关闭连接

- 通信结束时，客户端和服务器会协商关闭SSL/TLS连接。关闭连接的过程中，会通过“关闭通知”消息确保双方都安全地终止通信。









